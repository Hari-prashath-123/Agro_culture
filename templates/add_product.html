{% extends 'base.html' %}
{% block content %}
<h2>Add New Product</h2>
<div class="dashboard">
    <a href="{% url 'farmer_products' %}" class="file-upload-btn" style="margin-bottom:20px;display:inline-block;">&larr; Back to Your Products</a>
    <form method="post" enctype="multipart/form-data" id="productForm">
        {% csrf_token %}
        <p>
            <label for="id_name">Name:</label>
            {{ form.name }}
        </p>
        <p>
            <label for="id_category">Category:</label>
            {{ form.category }}
        </p>
        <p>
            <label for="id_price">Price:</label>
            {{ form.price }}
        </p>
        <p>
            <label for="id_quantity">Quantity:</label>
            {{ form.quantity }}
        </p>
        <p>
            <label for="id_image">Image:</label>
            <div class="drag-drop-area" id="dragDropArea">
                <div class="drag-drop-text">
                    <p>Drag & Drop your image here</p>
                    <p>or</p>
                    <label for="id_image" class="file-upload-btn">Browse Files</label>
                </div>
                <div id="imagePreview"></div>
            </div>
            {{ form.image }}
        </p>
        <button type="submit">Add Product</button>
    </form>
    <script>
        const dragDropArea = document.getElementById('dragDropArea');
        const fileInput = document.getElementById('id_image');
        const imagePreview = document.getElementById('imagePreview');
        fileInput.style.display = 'none';
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dragDropArea.addEventListener(eventName, preventDefaults, false);
            document.body.addEventListener(eventName, preventDefaults, false);
        });
        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }
        ['dragenter', 'dragover'].forEach(eventName => {
            dragDropArea.addEventListener(eventName, highlight, false);
        });
        ['dragleave', 'drop'].forEach(eventName => {
            dragDropArea.addEventListener(eventName, unhighlight, false);
        });
        function highlight(e) {
            dragDropArea.classList.add('highlight');
        }
        function unhighlight(e) {
            dragDropArea.classList.remove('highlight');
        }
        dragDropArea.addEventListener('drop', handleDrop, false);
        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            handleFiles(files);
        }
        fileInput.addEventListener('change', function(e) {
            handleFiles(this.files);
        });
        function handleFiles(files) {
            if (files.length > 0) {
                const file = files[0];
                fileInput.files = files;
                previewImage(file);
            }
        }
        function previewImage(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                imagePreview.innerHTML = `<img src="${e.target.result}" style="max-width: 200px; max-height: 200px; border-radius: 8px; margin-top: 10px;">`;
            }
            reader.readAsDataURL(file);
        }
    </script>
    {% if messages %}
        <ul>
        {% for message in messages %}
            <li>{{ message }}</li>
        {% endfor %}
        </ul>
    {% endif %}
</div>
{% endblock %}
